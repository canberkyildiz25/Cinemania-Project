{"version":3,"file":"my-library-D84mEWrp.js","sources":["../../src/app/pages/my-library/my-library.js"],"sourcesContent":["// src/app/pages/my-library/my-library.js\nimport { fetchMovieDetails } from '../../data/movies-data.js';\nimport { renderMovieCard, updateHeroWithMovie } from '../../common/ui-helpers.js';\n\nconst initLibrary = async () => {\n  const grid = document.getElementById('library-grid');\n  const heroSection = document.getElementById('library-hero');\n  const heroContent = document.getElementById('library-hero-content');\n  const genreContainer = document.getElementById('genre-filter-container');\n  const genreHeader = document.getElementById('genre-header');\n  const genreTextSpan = document.getElementById('selected-genre-text');\n  const genreList = document.getElementById('genre-list');\n  const loadMoreContainer = document.getElementById('load-more-container');\n  const loadMoreBtn = document.getElementById('load-more-btn');\n\n  if (!grid) return;\n\n  const storedIds = JSON.parse(localStorage.getItem('myLibrary') || '[]');\n  const numericIds = (Array.isArray(storedIds) ? storedIds : [])\n    .map((v) => Number(v))\n    .filter((v) => Number.isFinite(v) && v > 0);\n\n  if (!numericIds.length) {\n    grid.innerHTML = `\n      <div class=\"library-message\">\n        <p style=\"font-size: 24px; font-weight: 500; margin-bottom: 10px;\">OOPS...</p>\n        <p>Henüz bir film eklemediniz!</p>\n        <a href=\"./catalog.html\" class=\"btn btn-primary\" style=\"margin-top:20px; display:inline-block;\">Kataloğa Git</a>\n      </div>`;\n    if (genreContainer) genreContainer.style.display = 'none';\n    if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\n    return;\n  }\n\n  const results = await Promise.allSettled(\n    numericIds.map((id) => fetchMovieDetails(id))\n  );\n\n  const allMovies = [];\n  const successfulIds = [];\n\n  results.forEach((r, idx) => {\n    const id = numericIds[idx];\n    if (r.status === 'fulfilled' && r.value) {\n      allMovies.push(r.value);\n      successfulIds.push(id);\n    }\n  });\n\n  localStorage.setItem('myLibrary', JSON.stringify(successfulIds));\n\n  if (allMovies.length > 0) {\n    await updateHeroWithMovie(allMovies[0].id, heroSection, heroContent);\n  }\n\n  // Tür Filtreleme\n  const availableGenres = new Map();\n  allMovies.forEach((movie) => {\n    if (movie.genres) {\n      movie.genres.forEach((g) => availableGenres.set(g.id, g.name));\n    }\n  });\n\n  if (genreList) {\n    const allItem = document.createElement('div');\n    allItem.className = 'genre-item active';\n    allItem.textContent = 'All Genres';\n    allItem.dataset.id = 'all';\n    genreList.appendChild(allItem);\n\n    availableGenres.forEach((name, id) => {\n      const item = document.createElement('div');\n      item.className = 'genre-item';\n      item.textContent = name;\n      item.dataset.id = id;\n      genreList.appendChild(item);\n    });\n  }\n\n  if (genreHeader) {\n    genreHeader.addEventListener('click', (e) => {\n      e.stopPropagation();\n      genreList.classList.toggle('is-hidden');\n      genreContainer.classList.toggle('is-open');\n    });\n  }\n\n  document.addEventListener('click', (e) => {\n    if (genreContainer && !genreContainer.contains(e.target)) {\n      genreList.classList.add('is-hidden');\n      genreContainer.classList.remove('is-open');\n    }\n  });\n\n  let currentGenreId = 'all';\n  let filteredMovies = [...allMovies];\n\n  if (genreList) {\n    genreList.addEventListener('click', (e) => {\n      if (e.target.classList.contains('genre-item')) {\n        currentGenreId = e.target.dataset.id;\n        const genreName = e.target.textContent;\n        if (genreTextSpan) genreTextSpan.textContent = genreName === 'All Genres' ? 'Genre' : genreName;\n\n        document.querySelectorAll('.genre-item').forEach((item) => item.classList.remove('active'));\n        e.target.classList.add('active');\n        genreList.classList.add('is-hidden');\n        genreContainer.classList.remove('is-open');\n        applyFilter();\n      }\n    });\n  }\n\n  let renderedCount = 0;\n  const PER_PAGE = 6;\n\n  function applyFilter() {\n    if (currentGenreId === 'all') {\n      filteredMovies = [...allMovies];\n    } else {\n      filteredMovies = allMovies.filter((m) =>\n        m.genres.some((g) => g.id.toString() === currentGenreId.toString())\n      );\n    }\n\n    renderedCount = 0;\n    grid.innerHTML = '';\n\n    if (filteredMovies.length === 0) {\n      grid.innerHTML = `<div class=\"library-message\">Bu türde film bulunamadı.</div>`;\n      if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\n    } else {\n      renderBatch();\n    }\n  }\n\n  function renderBatch() {\n    const nextBatch = filteredMovies.slice(renderedCount, renderedCount + PER_PAGE);\n    const html = nextBatch.map((m) => renderMovieCard(m)).join('');\n    grid.insertAdjacentHTML('beforeend', html);\n    renderedCount += nextBatch.length;\n\n    if (renderedCount >= filteredMovies.length) {\n      if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\n    } else {\n      if (loadMoreContainer) loadMoreContainer.classList.remove('is-hidden');\n    }\n  }\n\n  if (loadMoreBtn) {\n    loadMoreBtn.addEventListener('click', renderBatch);\n  }\n\n  renderBatch();\n\n  grid.addEventListener('click', (e) => {\n    const card = e.target.closest('.movie-card');\n    if (card && card.dataset.id) {\n      updateHeroWithMovie(card.dataset.id, heroSection, heroContent);\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  });\n};\n\ninitLibrary();\n"],"names":["initLibrary","grid","heroSection","heroContent","genreContainer","genreHeader","genreTextSpan","genreList","loadMoreContainer","loadMoreBtn","storedIds","numericIds","v","results","id","fetchMovieDetails","allMovies","successfulIds","r","idx","updateHeroWithMovie","availableGenres","movie","g","allItem","name","item","currentGenreId","filteredMovies","genreName","applyFilter","renderedCount","PER_PAGE","m","renderBatch","nextBatch","html","renderMovieCard","card"],"mappings":"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"}